
## 概要
VPC構築

## 要件
- VPC
  - DNSホスト名：有効
  - DNS解決：有効（Auroraサーバレスの利用を見越した設定）
  - CIDRブロック「〜〜」
- public
  - 機能要件
    - 異なるAZで2サブネット用意
    - インターネット通信を許可
    - NatGatewayを配置（EC2のミドルウェア、ソフトウェアのため）   
    - ALBを配置予定
    - エフェメラルポートの許可
  - 非機能要件
    - NatGateway利用終了後に停止（Cloudwatch起動時に一時的に再開）
- private
  - 機能要件
    - 異なるAZで2サブネット用意
    - アプリサーバ（EC2）、DBサーバ（Auroraサーバレス）を配置予定
    - パブリックサブネットとの相互通信のみ許可
    - DBサブネットグループを作成
  - 非機能要件
    - なし

## 手順
- VPC作成
  - VPCをCIDRブロック「〜〜」で作成。作成時以下を設定
    - DNSホスト名：有効
    - DNS解決：有効
- サブネット作成
  - パブリック用サブネット「public-1a」「public-1c」を作成。
  - プライベート用サブネット「private-1a」「private-1c」を作成
- インターネットゲートウェイ作成
  - インターネットゲートウェイを作成
  - VPCにアタッチ
- Natgatewayを作成
  - EIPを取得
  - natgatewayを作成
  - サブネット「public-1a」にアタッチ
- ルートテーブル作成
  - パブリック用ルートテーブル「public-rt」を作成。0.0.0.0をINGWへルーティング。
  - サブネット「public-1a」「public-1c」に関連づける
  - プライベート用ルートテーブル「pryvate-rt」を作成。0.0.0.0をNatgatewayへルーティング。
  - サブネット「private-1a」「private-1c」に関連づける
- セキュリティグループ作成
  - パブリック用セキュリティグループ「public-sg」を作成する
  - プライベート用セキュリティグループ「private-sg」を作成する
- DBサブネットグループ作成
  - サブネット「private-1a」「private-1c」を含んだDBサブネットグループを作成する


## 対応ナレッジ
- セキュリティグループでエフェメラルポートの許可
- DNS設定をしないとIPが変わるようなサービスとの連携ができない
- Auroraの作成場所としてDBサブネットグループが必要
- Auroraの作成には2つ以上の異なるAZのサブネットが必要
- セキュリティグループの設定はEC2やAurora作成時に実施
- INGWのアタッチ先はVPC
