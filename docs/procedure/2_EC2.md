## 概要
EC2を起動し、Wordpressを稼働させる
- EC2起動
- セキュリティグループ設定
- Apacheインストール
- PHPと周辺モジュールインストール
- Wordpressダウンロード

## 要件
- EC2
  - 非機能要件
    - レスポンス速度を要件としない
    - wordpress稼働に必要なストレージのみでOK
    - 接続元IPアドレスが変動するためセキュリティグループでSSH接続を許可するIPアドレスを固定したくない
      SSM接続する運用とする


## 手順作成
- SSM接続準備
  - IAMロール「wp-for_ec2_ssm-role」を作成
  - 対象サービス：EC2
  - 許可ポリシー：AmazonSSMManagedInstanceCore

- EC2起動
  - 名前：「wp-1a-ec2」
  - AMI：Amazon Linux 2023 karnel-6.1 AMI
  - アーキテクチャ：x86_64
  - インスタンスタイプ：t3.micro
  - パブリックIPの自動割り当て：有効
  - ~~新しいキーペア「wp-ec2-key」を作成~~ キーペアは不要
  - セキュリティグループ「wp-ec2-sg」を作成
    - ~~一時的に0.0.0.0/0からのSSH接続を許可（ALB作成時に別途設定）~~　SSH接続はチェックを外す
    - HTTP通信を許可
  - ストレージタイプ：20GiB gp3
  - IAMインスタンスプロフィール：wp-for_ec2_ssm-role
 
- wordpress起動
  - 作成したEC2にSSM接続
  - 以下コマンドを順次実行
```
# ルートユーザにスイッチ
sudo su -

# パッケージの更新
sudo dnf update -y

# Apache、PHP、および必要な拡張ライブラリを一括インストール
sudo dnf install -y httpd php php-mysqlnd php-gd php-xml php-mbstring php-intl

# PHP-FPMの起動と自動起動設定
sudo systemctl start php-fpm
sudo systemctl enable php-fpm

# Apacheの起動
sudo systemctl start httpd

# OS起動時に自動実行されるように設定
sudo systemctl enable httpd

# 状態確認（Active: active (running) と出ればOK）
sudo systemctl status httpd

# テンポラリディレクトリへ移動
cd /tmp

# 最新版のダウンロード
wget https://wordpress.org/latest.tar.gz

# 解凍
tar -xzf latest.tar.gz

# Apacheのドキュメントルート（公開場所）へコピー
sudo cp -r wordpress/* /var/www/html/
# 所有者をapacheユーザーに変更
sudo chown -R apache:apache /var/www/html/

# 書き込み権限の調整
sudo chmod -R 755 /var/www/html/

# MySQLクライアントのインストール
sudo dnf install -y mariadb105
```


## 実施後と比較して
手詰まりなく手順通り実施完了

## 対応ナレッジ
- 当初はEC2にSSH接続することを想定していたが、接続元IPアドレスが固定でないため変更都度設定を変える必要があった。SSM接続を利用することで固定の接続元IPアドレスに依存せず接続が可能となった。
- インスタンスタイプはt3.microとしたがt4g.microと迷った。wordpressはarmタイプのCPUでも動作が担保されており、かつコストメリットもあったが初回ということもありより実績のあるt3.microを選定した。
- 完成した！と思いさっそくブラウザからアクセスしてみたら不明なIPとの表示が。。なぜと思いよくみてみたらプライベートIPアドレスを利用していた。とほほ、、ではあったが無事インストールまで完了できてよかった。
- この辺りからmarkdown方式のドキュメントの書き方を少しずつ覚えてきた
