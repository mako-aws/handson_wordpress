## 概要
ALBを設定。現時点ではEC2一台のみをターゲットとして設定する


## 要件


## 手順作成
- ターゲットグループを作成
  - ターゲットの種類：インスタンス
  - ターゲットグループ名：「wp-ec2-tg」
  - プロトコル：HTTP ポート：80
  - IPアドレスタイプ：IPv4
  - VPC：「wp」
  - プロトコルバージョン：HTTP1
  - ヘルスチェック：変更なし
  - ターゲットオプティマイザー：なし
- ALB用セキュリティグループを作成
  - セキュリティグループ名：「wp-alb-sg」
  - VPC：「wp」
  - インバウンドルール
  - タイプ：カスタムTCP
  - ポート範囲：80
  - リソースタイプ：AnywhereIPv4
  - アウトバウンドルールは変更なし（フルオープン） 
- ALBを作成
  - ロードバランサータイプ：ALB
  - ロードバランサー名：「wp-alb」
  - スキーム：インターネット向け
  - IPアドレスタイプ：IPv4
  - VPC：「wp」
  - IPプール：なし
  - AZとサブネット：「wp-public-1a-sn」「wp-public-1c-sn」
  - セキュリティグループ：「wp-alb-sg」
  - プロトコル：HTTP
  - アクションのルーティング：ターゲットグループへ転送
  - ターゲットグループ：「wp-ec2-tg」
  - ターゲットグループの維持：有効　一時間
 
- Wordpress初期設定
  - database name：wordpress
  - user name：wp_1a_rds_master
  - password：IpUQz3ndXDLWvQ8SzllJ
  - database host：wp-1a-rds.cdq2sc0sow5f.ap-northeast-1.rds.amazonaws.com
  - table prefix：wp_

## 実施後と比較して
  - 用意した手順でハンズオンしたのち、手順通りに進まなかった点をピックアップ
  - トラブルシューティングをまとめる

## 対応ナレッジ
- ALBはALBグループのような振る舞いをする。ALBを一つ作成すると、実際には2以上のサブネットに複数作成される。（ネットワークマッピング）
- 固定IPは存在しない（というかユーザ側はIPを意識しない）。ALB作成時にFQDNが発行されるので、それをエンドポイントして利用できる。
- トラフィックの通過点だから、ALBにもセキュリティグループに設定がいるんですね。HTTPもしくはHTTPSしか受け付けないように設定すればへんな通信を遮断できるね
- RDSはスタンバイ機作成すると無料枠の対象から外れるため冗長構成を断念した。
- HTTPは従来のHTTP1を利用。高速のHTTP2もあるようだが、wordpressが対応していないようなので利用しない。
- ターゲットオプティマイザー：アクセス数の上限を決める。上限以上は503エラーになる。高負荷処理が必要なワークロードにおいて過負荷になることを回避するためのオプション
- IPAM：IP Adress Manegerのこと。IPの被りを防止してくれる。オンプレで使っているレンジ帯のIPアドレスをALBに付与したい時に使う。IPAMプールのID入れるとやってくれる。
- ターゲットグループの維持：スティッキーセッションの機能。有効にするのが無難。セッション中は他のターゲットグループにルーティングされないよう、cookieにルーティングしたサーバの情報を書き込む。次にこのクライアントからリクエストが来た時はcookieの情報を読んで同じサーバにルーティングする。
  
